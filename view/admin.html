<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JobBoard - Administration</title>
    <link rel="stylesheet" href="../public/style.css">
    <style>
        .admin-section {
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .admin-section h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .data-table th, .data-table td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .data-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .action-btn {
            margin: 0 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }
        .action-btn.edit {
            background-color: #ffc107;
        }
        .action-btn.delete {
            background-color: #dc3545;
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <h1>JobBoard - Administration</h1>
            <ul>
                <li><a href="index.html">Retour au site</a></li>
                <li><a href="#" onclick="logout()">Déconnexion</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div id="admin-content">
            <h2>Panneau d'administration</h2>
            
            <div class="admin-section">
                <h3>Gestion des annonces</h3>
                <button onclick="loadAnnonces()" class="btn">Charger les annonces</button>
                <div id="annonces-list"></div>
            </div>

            <div class="admin-section">
                <h3>Gestion des utilisateurs</h3>
                <button onclick="loadUsers()" class="btn">Charger les utilisateurs</button>
                <div id="users-list"></div>
            </div>

            <div class="admin-section">
                <h3>Gestion des entreprises</h3>
                <button onclick="loadCompanies()" class="btn">Charger les entreprises</button>
                <div id="companies-list"></div>
            </div>

            <div class="admin-section">
                <h3>Gestion des candidatures</h3>
                <button onclick="loadApplications()" class="btn">Charger les candidatures</button>
                <div id="applications-list"></div>
            </div>
        </div>
    </main>

    <script>
        // Vérifier si l'utilisateur est admin
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user || user.role !== 'admin') {
            document.getElementById('admin-content').innerHTML = 
                '<p class="message error">Accès refusé. Vous devez être administrateur.</p>';
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        function loadAnnonces() {
            fetch('/api/annonce')
                .then(response => response.json())
                .then(annonces => {
                    const container = document.getElementById('annonces-list');
                    if (annonces.length === 0) {
                        container.innerHTML = '<p>Aucune annonce trouvée.</p>';
                        return;
                    }

                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>Titre</th><th>Lieu</th><th>Actions</th></tr></thead><tbody>';
                    annonces.forEach(annonce => {
                        html += `
                            <tr>
                                <td>${annonce.id}</td>
                                <td>${annonce.titre}</td>
                                <td>${annonce.lieu}</td>
                                <td>
                                    <button class="btn action-btn edit" onclick="editAnnonce(${annonce.id})">Modifier</button>
                                    <button class="btn action-btn delete" onclick="deleteAnnonce(${annonce.id})">Supprimer</button>
                                </td>
                            </tr>
                        `;
                    });
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('annonces-list').innerHTML = 
                        '<p class="message error">Erreur lors du chargement des annonces.</p>';
                });
        }

        function loadUsers() {
            fetch('/api/people')
                .then(response => response.json())
                .then(users => {
                    const container = document.getElementById('users-list');
                    if (users.length === 0) {
                        container.innerHTML = '<p>Aucun utilisateur trouvé.</p>';
                        return;
                    }

                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>Nom</th><th>Email</th><th>Rôle</th><th>Actions</th></tr></thead><tbody>';
                    users.forEach(user => {
                        html += `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.nom} ${user.prenom}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>
                                    <button class="btn action-btn edit" onclick="editUser(${user.id})">Modifier</button>
                                    <button class="btn action-btn delete" onclick="deleteUser(${user.id})">Supprimer</button>
                                </td>
                            </tr>
                        `;
                    });
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('users-list').innerHTML = 
                        '<p class="message error">Erreur lors du chargement des utilisateurs.</p>';
                });
        }

        function loadCompanies() {
            fetch('/api/companies')
                .then(response => response.json())
                .then(companies => {
                    const container = document.getElementById('companies-list');
                    if (companies.length === 0) {
                        container.innerHTML = '<p>Aucune entreprise trouvée.</p>';
                        return;
                    }

                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>Nom</th><th>Localisation</th><th>Actions</th></tr></thead><tbody>';
                    companies.forEach(company => {
                        html += `
                            <tr>
                                <td>${company.id}</td>
                                <td>${company.name}</td>
                                <td>${company.location}</td>
                                <td>
                                    <button class="btn action-btn edit" onclick="editCompany(${company.id})">Modifier</button>
                                    <button class="btn action-btn delete" onclick="deleteCompany(${company.id})">Supprimer</button>
                                </td>
                            </tr>
                        `;
                    });
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('companies-list').innerHTML = 
                        '<p class="message error">Erreur lors du chargement des entreprises.</p>';
                });
        }

        function loadApplications() {
            fetch('/api/applications')
                .then(response => response.json())
                .then(applications => {
                    const container = document.getElementById('applications-list');
                    if (applications.length === 0) {
                        container.innerHTML = '<p>Aucune candidature trouvée.</p>';
                        return;
                    }

                    let html = '<table class="data-table"><thead><tr><th>ID</th><th>Personne</th><th>Annonce</th><th>Actions</th></tr></thead><tbody>';
                    applications.forEach(app => {
                        html += `
                            <tr>
                                <td>${app.id}</td>
                                <td>${app.id_personne}</td>
                                <td>${app.id_advertisement}</td>
                                <td>
                                    <button class="btn action-btn edit" onclick="editApplication(${app.id})">Modifier</button>
                                    <button class="btn action-btn delete" onclick="deleteApplication(${app.id})">Supprimer</button>
                                </td>
                            </tr>
                        `;
                    });
                    html += '</tbody></table>';
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('applications-list').innerHTML = 
                        '<p class="message error">Erreur lors du chargement des candidatures.</p>';
                });
        }

        // Fonctions de suppression (simples confirmations)
        function deleteAnnonce(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette annonce ?')) {
                fetch(`/api/annonce/${id}`, { method: 'DELETE' })
                    .then(() => loadAnnonces())
                    .catch(error => console.error('Erreur:', error));
            }
        }

        function deleteUser(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
                fetch(`/api/people/${id}`, { method: 'DELETE' })
                    .then(() => loadUsers())
                    .catch(error => console.error('Erreur:', error));
            }
        }

        function deleteCompany(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette entreprise ?')) {
                fetch(`/api/companies/${id}`, { method: 'DELETE' })
                    .then(() => loadCompanies())
                    .catch(error => console.error('Erreur:', error));
            }
        }

        function deleteApplication(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette candidature ?')) {
                fetch(`/api/applications/${id}`, { method: 'DELETE' })
                    .then(() => loadApplications())
                    .catch(error => console.error('Erreur:', error));
            }
        }

        // Fonctions d'édition (placeholders)
        function editAnnonce(id) {
            alert('Fonctionnalité d\'édition à implémenter pour l\'annonce ' + id);
        }

        function editUser(id) {
            alert('Fonctionnalité d\'édition à implémenter pour l\'utilisateur ' + id);
        }

        function editCompany(id) {
            alert('Fonctionnalité d\'édition à implémenter pour l\'entreprise ' + id);
        }

        function editApplication(id) {
            alert('Fonctionnalité d\'édition à implémenter pour la candidature ' + id);
        }
    </script>
</body>
</html>
